<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Add new syntax into Nestacms for use with Ultraviolet and Textpow &#8211; Aaron Addleman</title>
<meta name="description" content="While using Nestacms, I wanted to add a new syntax to Textpow and Ultraviolet for parsing some varnish configuration language files (or vcl files) to display on my web site. My adventure on this turned out to be easy once I realized how cool Nesta really is!">
<meta name="keywords" content="ruby">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/8160155219_edf33c3485_o.jpg">

<meta name="twitter:title" content="Add new syntax into Nestacms for use with Ultraviolet and Textpow">
<meta name="twitter:description" content="While using Nestacms, I wanted to add a new syntax to Textpow and Ultraviolet for parsing some varnish configuration language files (or vcl files) to display on my web site. My adventure on this turned out to be easy once I realized how cool Nesta really is!">
<meta name="twitter:creator" content="@aaronaddleman">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Add new syntax into Nestacms for use with Ultraviolet and Textpow">
<meta property="og:description" content="While using Nestacms, I wanted to add a new syntax to Textpow and Ultraviolet for parsing some varnish configuration language files (or vcl files) to display on my web site. My adventure on this turned out to be easy once I realized how cool Nesta really is!">
<meta property="og:url" content="/articles/add-syntax-to-textpow-for-ultraviolet/">
<meta property="og:site_name" content="Aaron Addleman">





<link rel="canonical" href="/articles/add-syntax-to-textpow-for-ultraviolet/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Aaron Addleman Feed">
<link rel="author" href="aaronaddleman?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/css/uv/eiffel.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="Aaron Addleman photo" class="author-photo">
					<h4>Aaron Addleman</h4>
					<p>Nerd and geek with passion for learning and exploring.</p>
				</li>
				<li><a href="/about/">Learn More</a></li>
				<li>
					<a href="mailto:aaronaddleman@gmail.com"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/aaronaddleman"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="http://facebook.com/aaronaddleman"><i class="fa fa-facebook"></i> Facebook</a>
				</li>
				<li>
					<a href="aaronaddleman"><i class="fa fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="http://linkedin.com/pub/aaron-addleman/0/428/276"><i class="fa fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/aaronaddleman"><i class="fa fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">All Posts</a></li>
				<li><a href="/tags/">All Tags</a></li>
			</ul>
		</li>
		<li><a href="/resume">Resume</a></li>
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  <div class="image-credit">Image source: Aaron Addleman</div><!-- /.image-credit -->
  <div class="entry-image">
    <img src="/images/8160155219_edf33c3485_o.jpg" alt="Add new syntax into Nestacms for use with Ultraviolet and Textpow">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/articles/add-syntax-to-textpow-for-ultraviolet/" rel="bookmark" title="Add new syntax into Nestacms for use with Ultraviolet and Textpow">Add new syntax into Nestacms for use with Ultraviolet and Textpow</a></h1>
        
        <h2>June 18, 2013</h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~2 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Flags: draft</p>

<h1 id="add-new-syntax-into-nestacms-for-use-with-ultraviolet-and-textpow">Add new syntax into Nestacms for use with Ultraviolet and Textpow</h1>

<h2 id="how-to-start">How to start</h2>

<p>Make sure you have all the necessary changes to Nestacms for <a href="/articles/rack-codehighligher">Setting up rack-codehighligher with Nestacms</a>.</p>

<h2 id="converting-a-textmate-syntax-bundle">Converting a Textmate Syntax bundle</h2>

<p>Download the bundle (usually from a github respository) to get ready for conversion. Once you have the <code>Language.tmLanguage</code> convert the language file to a yaml file which should end up with a file name like <code>source.Language.syntax</code> by using this command:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">plist2yaml Language.tmLanguage &gt; source.Language.syntax</code></pre></div>

<p>If you get an error like the following you need to be inside the <code>Language.tmbundle/Syntaxes</code> directory where the <code>.tmLanuage</code> file is located:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/Users/aaron/.rvm/gems/ruby-1.9.2-p320/gems/plist-3.1.0/lib/plist/parser.rb:67:in <span class="sb">`</span><span class="nb">read</span><span class="s1">&#39;: Is a directory - Varnish.tmbundle (Errno::EISDIR)</span>
<span class="s1">  from /Users/aaron/.rvm/gems/ruby-1.9.2-p320/gems/plist-3.1.0/lib/plist/parser.rb:67:in `initialize&#39;</span>
  from /Users/aaron/.rvm/gems/ruby-1.9.2-p320/gems/plist-3.1.0/lib/plist/parser.rb:28:in <span class="sb">`</span>new<span class="s1">&#39;</span>
<span class="s1">  from /Users/aaron/.rvm/gems/ruby-1.9.2-p320/gems/plist-3.1.0/lib/plist/parser.rb:28:in `parse_xml&#39;</span>
  from /Users/aaron/.rvm/gems/ruby-1.9.2-p320/gems/textpow-1.3.0/bin/plist2yaml:7:in <span class="sb">`</span>&lt;top <span class="o">(</span>required<span class="o">)</span>&gt;<span class="s1">&#39;</span>
<span class="s1">  from /Users/aaron/.rvm/gems/ruby-1.9.2-p320/bin/plist2yaml:19:in `load&#39;</span>
  from /Users/aaron/.rvm/gems/ruby-1.9.2-p320/bin/plist2yaml:19:in <span class="sb">`</span>&lt;main&gt;<span class="s1">&#39;</span>
<span class="s1">  from /Users/aaron/.rvm/gems/ruby-1.9.2-p320/bin/ruby_noexec_wrapper:14:in `eval&#39;</span>
  from /Users/aaron/.rvm/gems/ruby-1.9.2-p320/bin/ruby_noexec_wrapper:14:in <span class="sb">`</span>&lt;main&gt;<span class="err">&#39;</span></code></pre></div>

<h2 id="load-the-syntax-file-into-nestacms">Load the syntax file into Nestacms</h2>

<p>By adding the following code into your app.rb file the syntax will be available:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Textpow</span><span class="o">::</span><span class="no">SyntaxNode</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;public/syntaxes/source.vcl.syntax&#39;</span><span class="p">,</span> <span class="no">Nesta</span><span class="o">::</span><span class="no">App</span><span class="o">.</span><span class="n">root</span><span class="p">))</span></code></pre></div>

<h2 id="use-the-syntax-on-you-files">Use the syntax on you files</h2>

<p>To apply the syntax I came up with some code for printing code from the <code>app.rb</code> file by making this method:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># load custom syntaxes</span>
<span class="no">Textpow</span><span class="o">::</span><span class="no">SyntaxNode</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;public/syntaxes/source.vcl.syntax&#39;</span><span class="p">,</span> <span class="no">Nesta</span><span class="o">::</span><span class="no">App</span><span class="o">.</span><span class="n">root</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">print_code</span><span class="p">(</span><span class="n">opt</span><span class="o">=</span><span class="p">{})</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="n">opt</span><span class="o">[</span><span class="ss">:filename</span><span class="o">]</span>
  <span class="n">theme</span> <span class="o">=</span> <span class="n">opt</span><span class="o">[</span><span class="ss">:theme</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;brilliance_black&quot;</span>
  <span class="n">syntax</span> <span class="o">=</span> <span class="n">opt</span><span class="o">[</span><span class="ss">:syntax</span><span class="o">]</span>
  <span class="n">show_code</span> <span class="o">=</span> <span class="n">opt</span><span class="o">[</span><span class="ss">:show_code</span><span class="o">]</span> <span class="o">||</span> <span class="kp">true</span>
  <span class="n">text</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span> <span class="o">+</span> <span class="s1">&#39;/public/&#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
  <span class="n">processor</span> <span class="o">=</span> <span class="no">Textpow</span><span class="o">::</span><span class="no">RecordingProcessor</span><span class="o">.</span><span class="n">new</span>
  <span class="n">result</span> <span class="o">=</span> <span class="no">Uv</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="n">text</span><span class="p">,</span> <span class="s2">&quot;xhtml&quot;</span><span class="p">,</span> <span class="n">syntax</span><span class="p">,</span> <span class="kp">false</span><span class="p">,</span> <span class="s2">&quot;eiffel&quot;</span><span class="p">)</span>
  <span class="n">haml</span><span class="p">(</span><span class="ss">:print_code</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:code</span> <span class="o">=&gt;</span> <span class="n">result</span><span class="p">,</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="n">filename</span> <span class="p">})</span>
  <span class="k">case</span> <span class="n">show_code</span>
  <span class="k">when</span> <span class="kp">true</span>
    <span class="k">return</span> <span class="n">haml</span><span class="p">(</span><span class="ss">:print_code</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:code</span> <span class="o">=&gt;</span> <span class="n">result</span><span class="p">,</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="n">filename</span> <span class="p">})</span>
  <span class="k">when</span> <span class="kp">false</span>
    <span class="k">return</span> <span class="n">download_link</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Now when you want to call some code, make a <code>haml</code> file and include the file with the following:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">=</span> print_code<span class="o">(</span><span class="s2">&quot;file_with_language.vcl&quot;</span><span class="o">)</span></code></pre></div>

<h1 id="notes">Notes</h1>

<p>To list the availble syntaxes:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">uv --list syntaxes</code></pre></div>


      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#ruby" title="Pages tagged ruby" class="tag">ruby</a></span>
        <span><a href="/articles/add-syntax-to-textpow-for-ultraviolet/" rel="bookmark" title="Add new syntax into Nestacms for use with Ultraviolet and Textpow">Add new syntax into Nestacms for use with Ultraviolet and Textpow</a> was published on <span class="entry-date date published updated"><time datetime="2013-06-18T00:00:00-07:00">June 18, 2013</time></span></span>
        
        <span class="author vcard"><span class="fn"><a href="/about/" title="About Aaron Addleman">Aaron Addleman</a></span></span>
        <div class="social-share">
          <ul class="socialcount socialcount-small inline-list">
            <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/articles/add-syntax-to-textpow-for-ultraviolet/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
            <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/articles/add-syntax-to-textpow-for-ultraviolet/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
            <li class="googleplus"><a href="https://plus.google.com/share?url=/articles/add-syntax-to-textpow-for-ultraviolet/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
          </ul>
        </div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="/articles/monitoring-log-files-visually/" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="/articles/ruby-interesting-methods/" title="Ruby's 'Interesting methods'">Ruby's 'Interesting methods'</a></h3>
          <p>While in IRB and listing methods on an object, adding this new method to the Object allows for helpful listing of methods. <a href="/articles/ruby-interesting-methods/">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="/articles/sourcetree-cli/" title="SourceTree cli">SourceTree cli</a></h4>
            <span>Published on July 25, 2014</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="/articles/multiple-line-editing-with-sublime-text-2/" title="Multiple Line Editing with Sublime Text 2">Multiple Line Editing with Sublime Text 2</a></h4>
            <span>Published on August 21, 2013</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Aaron Addleman. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'aaronaddleman'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>	        

</body>
</html>
